<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>24-Hour Clock — Numbers + Hand Lock</title>
<style>
  :root{ --hour:#2563eb; --min:#dc2626; }
  body{font-family:Arial,Helvetica,sans-serif;text-align:center;background:#f0f0f0;margin:20px}
  .clock-wrap{background:#fff;border-radius:16px;max-width:420px;margin:18px auto;padding:14px 14px 18px;box-shadow:0 4px 18px rgba(0,0,0,.08)}
  h2{margin:0 0 14px} h3{margin:6px 0 10px}
  canvas{background:#fff;border-radius:50%;display:block;margin:12px auto;touch-action:none;border:5px solid;width:300px;height:300px}
  .controls{display:flex;justify-content:center;gap:8px;flex-wrap:wrap;margin:8px 0 2px}
  .btn{cursor:pointer;padding:8px 12px;border-radius:999px;border:1px solid #d0d0d0;background:#fafafa;font-size:14px;user-select:none}
  .btn[aria-pressed="true"]{border-color:#000;background:#fff}
  .btn.hour{outline:2px solid rgba(37,99,235,.2)}
  .btn.minute{outline:2px solid rgba(220,38,38,.2)}
  select{margin:6px;padding:6px 10px;font-size:16px}
  .row{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;align-items:center}
  .info{margin-top:16px;font-size:16px}
  .legend{font-size:13px;opacity:.8}
  .ampm{margin-top:4px;font-size:14px;opacity:.9}
  .dates{background:#fff;border-radius:16px;max-width:420px;margin:18px auto;padding:14px;box-shadow:0 4px 18px rgba(0,0,0,.08);border:2px solid #0ea5e9}
  .dates .row{gap:16px}
  input[type="date"]{padding:6px 10px;font-size:16px}
  @media (max-width:420px){ canvas{width:260px;height:260px} }
</style>
</head>
<body>

<h2>24-Hour Clock — Choose Date, then Time</h2>

<!-- NEW: Date pickers -->
<div class="dates">
  <h3>Pick Dates</h3>
  <div class="row">
    <label>Start Date: <input type="date" id="startDate"></label>
    <label>End Date: <input type="date" id="endDate"></label>
  </div>
</div>

<div class="clock-wrap" style="border:2px solid #16a34a">
  <h3>Start Time</h3>
  <div class="controls">
    <button class="btn hour"   data-target="start" data-hand="hour"   aria-pressed="true">Select Hour</button>
    <button class="btn minute" data-target="start" data-hand="minute" aria-pressed="false">Select Minute</button>
  </div>
  <canvas id="startClock" width="300" height="300" style="border-color:#16a34a"></canvas>
  <div class="row">
    Hour: <select id="startHour"></select>
    Minute: <select id="startMinute"></select>
  </div>
  <div class="ampm" id="startAmPm">12-hour: --:-- --</div>
</div>

<div class="clock-wrap" style="border:2px solid #dc2626">
  <h3>End Time</h3>
  <div class="controls">
    <button class="btn hour"   data-target="end" data-hand="hour"   aria-pressed="true">Select Hour</button>
    <button class="btn minute" data-target="end" data-hand="minute" aria-pressed="false">Select Minute</button>
  </div>
  <canvas id="endClock" width="300" height="300" style="border-color:#dc2626"></canvas>
  <div class="row">
    Hour: <select id="endHour"></select>
    Minute: <select id="endMinute"></select>
  </div>
  <div class="ampm" id="endAmPm">12-hour: --:-- --</div>
</div>

<div class="info">
  <div>Start: <span id="startDateOut">--</span> <span id="startTime">--:--</span></div>
  <div>End: <span id="endDateOut">--</span> <span id="endTime">--:--</span></div>
  <div>Difference: <span id="diffTime">--:--</span></div>
</div>

<script>
/* ---------- Shared state ---------- */
let startTotal = 9*60, endTotal = 17*60; // minutes since 00:00
let startDateStr = "", endDateStr = "";  // YYYY-MM-DD

const pad = n => String(n).padStart(2,"0");
const hmFromMin = m => ({h: Math.floor((m%1440+1440)%1440/60), m: ((m%60)+60)%60});
const minFromHM = (h,m) => ((h*60+m)%1440+1440)%1440;

/* NEW: date helpers */
const todayISO = () => {
  const d = new Date();
  const y = d.getFullYear(), m = d.getMonth()+1, day = d.getDate();
  return `${y}-${pad(m)}-${pad(day)}`;
};
const fmtDateNice = (iso) => {
  if(!iso) return "--";
  const [y,m,d] = iso.split("-").map(Number);
  const dt = new Date(y, m-1, d);
  const wk = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][dt.getDay()];
  const mos = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][dt.getMonth()];
  return `${wk}, ${d} ${mos} ${y}`;
};
const tsFromDateAndMinutes = (iso, totalMins) => {
  const {h,m} = hmFromMin(totalMins);
  // Local time; construct yyyy-mm-ddThh:mm for parsing
  return new Date(`${iso}T${pad(h)}:${pad(m)}:00`).getTime();
};

// 12h helpers
const fmt12FromMin = (mins) => {
  const {h, m} = hmFromMin(mins);
  const period = h < 12 ? "AM" : "PM";
  let h12 = h % 12; if (h12 === 0) h12 = 12;
  return `${h12}:${pad(m)} ${period}`;
};

function updateSummary(){
  // 24h readouts
  const sHM = hmFromMin(startTotal), eHM = hmFromMin(endTotal);
  document.getElementById("startTime").textContent = `${pad(sHM.h)}:${pad(sHM.m)} (${fmt12FromMin(startTotal)})`;
  document.getElementById("endTime").textContent   = `${pad(eHM.h)}:${pad(eHM.m)} (${fmt12FromMin(endTotal)})`;

  // date readouts
  document.getElementById("startDateOut").textContent = fmtDateNice(startDateStr);
  document.getElementById("endDateOut").textContent   = fmtDateNice(endDateStr);

  // keep the small per-clock 12h lines in sync
  const startAm = document.getElementById("startAmPm");
  const endAm = document.getElementById("endAmPm");
  if (startAm) startAm.textContent = `12-hour: ${fmt12FromMin(startTotal)}`;
  if (endAm)   endAm.textContent   = `12-hour: ${fmt12FromMin(endTotal)}`;

  // difference using full datetime
  let startTs = tsFromDateAndMinutes(startDateStr, startTotal);
  let endTs   = tsFromDateAndMinutes(endDateStr,   endTotal);

  // If same date and end earlier than start, assume next day for end
  if (startDateStr === endDateStr && endTs < startTs) {
    endTs += 24*60*60*1000;
  }

  const diffMs = endTs - startTs;
  if (isNaN(diffMs)) {
    document.getElementById("diffTime").textContent = `--:--`;
    return;
  }
  const totalMin = Math.max(0, Math.round(diffMs/60000));
  const days = Math.floor(totalMin / 1440);
  const hrs  = Math.floor((totalMin % 1440) / 60);
  const mins = totalMin % 60;
  const parts = [];
  if (days) parts.push(`${days}d`);
  parts.push(`${hrs}h ${mins}m`);
  document.getElementById("diffTime").textContent = parts.join(" ");
}

function scaleCanvas(canvas){
  const dpr = window.devicePixelRatio || 1;
  const rect = canvas.getBoundingClientRect();
  canvas.width = Math.round(rect.width*dpr);
  canvas.height= Math.round(rect.height*dpr);
  const ctx = canvas.getContext("2d");
  ctx.setTransform(dpr,0,0,dpr,0,0);
  return {ctx, r: Math.min(rect.width, rect.height)/2};
}

/* distance from point P to line segment AB */
function distPointToSeg(px,py, ax,ay, bx,by){
  const ABx=bx-ax, ABy=by-ay, APx=px-ax, APy=py-ay;
  const ab2 = ABx*ABx + ABy*ABy;
  const t = ab2 ? Math.max(0, Math.min(1, (APx*ABx + APy*ABy)/ab2)) : 0;
  const cx = ax + t*ABx, cy = ay + t*ABy;
  return Math.hypot(px - cx, py - cy);
}

function Clock({id, canvasId, hourSelectId, minuteSelectId, isStart}){
  const canvas = document.getElementById(canvasId);
  const hourSel = document.getElementById(hourSelectId);
  const minSel  = document.getElementById(minuteSelectId);
  const btnHour   = document.querySelector(`.btn.hour[data-target="${id}"]`);
  const btnMinute = document.querySelector(`.btn.minute[data-target="${id}"]`);

  const HOUR_W = 5, HOUR_W_ACTIVE = 7;
  const MIN_W  = 5, MIN_W_ACTIVE  = 7;
  const HITBOX_RADIUS = 18;

  let activeHand = "hour";
  const getTotal = ()=> isStart ? startTotal : endTotal;
  const setTotal = v => { if(isStart) startTotal=v; else endTotal=v; };

  // dropdowns
  for(let i=0;i<24;i++){ const o=document.createElement("option"); o.value=i; o.text=i; hourSel.appendChild(o); }
  for(let i=0;i<60;i++){ const o=document.createElement("option"); o.value=i; o.text=pad(i); minSel.appendChild(o); }
  let {h,m} = hmFromMin(getTotal()); hourSel.value=h; minSel.value=m;

  function setActive(hand){
    activeHand = hand;
    btnHour.setAttribute("aria-pressed", hand==="hour");
    btnMinute.setAttribute("aria-pressed", hand==="minute");
    draw();
  }

  btnHour.addEventListener("click", ()=>setActive("hour"));
  btnMinute.addEventListener("click",()=>setActive("minute"));

  function draw(){
    const {ctx, r} = scaleCanvas(canvas);
    ctx.translate(r,r);
    ctx.clearRect(-r,-r,2*r,2*r);

    // dial ring
    ctx.beginPath(); ctx.arc(0,0,r-4,0,Math.PI*2); ctx.fillStyle="#fff"; ctx.fill(); ctx.stroke();

    // numbers 0–23 (bold) + tick dots
    ctx.save();
    ctx.fillStyle = "#111";
    ctx.font = "bold 14px Arial";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    for(let i=0;i<24;i++){
      const a = (i/24)*Math.PI*2 - Math.PI/2;
      const nx = Math.cos(a)*(r-42), ny = Math.sin(a)*(r-42);
      ctx.fillText(i, nx, ny);

      const tx = Math.cos(a)*(r-24), ty = Math.sin(a)*(r-24);
      ctx.beginPath(); ctx.arc(tx,ty,2,0,Math.PI*2); ctx.fill();
    }
    ctx.restore();

    // hour hand
    const ha = ((h + m/60)/24)*Math.PI*2 - Math.PI/2;
    const HOUR_LEN = r - 65;
    ctx.save();
    ctx.strokeStyle = "var(--hour)";
    ctx.lineWidth   = activeHand==="hour" ? HOUR_W_ACTIVE : HOUR_W;
    ctx.beginPath(); ctx.moveTo(0,0);
    ctx.lineTo(Math.cos(ha)*HOUR_LEN, Math.sin(ha)*HOUR_LEN);
    ctx.stroke();
    ctx.restore();

    // minute hand
    const ma = (m/60)*Math.PI*2 - Math.PI/2;
    const MIN_LEN = r - 65;
    ctx.save();
    ctx.strokeStyle = "var(--min)";
    ctx.lineWidth   = activeHand==="minute" ? MIN_W_ACTIVE : MIN_W;
    ctx.shadowColor = "rgba(220,38,38,.40)";
    ctx.shadowBlur  = 6;
    ctx.beginPath(); ctx.moveTo(0,0);
    ctx.lineTo(Math.cos(ma)*MIN_LEN, Math.sin(ma)*MIN_LEN);
    ctx.stroke();
    ctx.restore();

    // center cap
    ctx.beginPath(); ctx.arc(0,0,4,0,Math.PI*2); ctx.fillStyle="#111"; ctx.fill();
  }

  function commit(){
    const total = minFromHM(h,m);
    setTotal(total);
    updateSummary();
    const targetId = isStart ? "startAmPm" : "endAmPm";
    const el = document.getElementById(targetId);
    if (el) el.textContent = `12-hour: ${fmt12FromMin(total)}`;
    draw();
  }

  const angleFrom = (x,y)=> (Math.atan2(y,x)+Math.PI/2+Math.PI*2)%(Math.PI*2);

  function handHitTest(clientX,clientY){
    const rect = canvas.getBoundingClientRect();
    const px = clientX - rect.left - rect.width/2;
    const py = clientY - rect.top  - rect.height/2;
    const r = Math.min(rect.width, rect.height)/2;

    const HLEN = r - 65;
    const MLEN = r - 65;

    if(activeHand==="hour"){
      const ha = ((h + m/60)/24)*Math.PI*2 - Math.PI/2;
      const hx = Math.cos(ha)*HLEN, hy = Math.sin(ha)*HLEN;
      return distPointToSeg(px,py, 0,0, hx,hy) <= HITBOX_RADIUS;
    }else{
      const ma = (m/60)*Math.PI*2 - Math.PI/2;
      const mx = Math.cos(ma)*MLEN, my = Math.sin(ma)*MLEN;
      return distPointToSeg(px,py, 0,0, mx,my) <= HITBOX_RADIUS;
    }
  }

  function updateFromPoint(clientX, clientY){
    const rect = canvas.getBoundingClientRect();
    const x = clientX - rect.left - rect.width/2;
    const y = clientY - rect.top  - rect.height/2;
    const a = angleFrom(x,y);
    if(activeHand==="hour"){ h = Math.floor((a/(Math.PI*2))*24)%24; hourSel.value=h; }
    else                   { m = Math.floor((a/(Math.PI*2))*60)%60; minSel.value=m; }
    commit();
  }

  let dragging=false;
  function onDown(clientX,clientY){
    if(handHitTest(clientX,clientY)){ dragging=true; updateFromPoint(clientX,clientY); }
  }
  function onMove(clientX,clientY){ if(dragging) updateFromPoint(clientX,clientY); }
  function stop(){ dragging=false; }

  canvas.addEventListener("mousedown", e=>{ onDown(e.clientX,e.clientY); window.addEventListener("mousemove", move); });
  function move(e){ onMove(e.clientX,e.clientY); }
  window.addEventListener("mouseup", stop);
  canvas.addEventListener("mouseleave", stop);

  canvas.addEventListener("touchstart", e=>{ e.preventDefault(); const t=e.touches[0]; onDown(t.clientX,t.clientY); }, {passive:false});
  canvas.addEventListener("touchmove",  e=>{ e.preventDefault(); const t=e.touches[0]; onMove(t.clientX,t.clientY); }, {passive:false});
  canvas.addEventListener("touchend",   stop);

  hourSel.addEventListener("change", e=>{ h=(+e.target.value)||0; setActive("hour"); commit(); });
  minSel .addEventListener("change", e=>{ m=(+e.target.value)||0; setActive("minute"); commit(); });

  setActive("hour");
  commit();
}

/* build both clocks */
Clock({id:"start", canvasId:"startClock", hourSelectId:"startHour", minuteSelectId:"startMinute", isStart:true});
Clock({id:"end",   canvasId:"endClock",   hourSelectId:"endHour",   minuteSelectId:"endMinute",   isStart:false});

/* NEW: initialize date inputs and wiring */
const startDateInput = document.getElementById("startDate");
const endDateInput   = document.getElementById("endDate");

// default both to today
startDateStr = todayISO();
endDateStr   = todayISO();
startDateInput.value = startDateStr;
endDateInput.value   = endDateStr;

startDateInput.addEventListener("change", e => {
  startDateStr = e.target.value || startDateStr;
  updateSummary();
});
endDateInput.addEventListener("change", e => {
  endDateStr = e.target.value || endDateStr;
  updateSummary();
});

updateSummary();
</script>
</body>
</html>
