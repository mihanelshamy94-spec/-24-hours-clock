<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>24-Hour Clock (Thick Minute + Full-hand Drag)</title>
<style>
  :root{ --hour:#2563eb; --min:#dc2626; }
  body{font-family:Arial,Helvetica,sans-serif;text-align:center;background:#f0f0f0;margin:20px}
  .clock-wrap{background:#fff;border-radius:16px;max-width:420px;margin:18px auto;padding:14px 14px 18px;box-shadow:0 4px 18px rgba(0,0,0,.08)}
  h2{margin:0 0 14px} h3{margin:6px 0 10px}
  canvas{background:#fff;border-radius:50%;display:block;margin:12px auto;touch-action:none;border:5px solid;width:300px;height:300px}
  .controls{display:flex;justify-content:center;gap:8px;flex-wrap:wrap;margin:8px 0 2px}
  .btn{cursor:pointer;padding:8px 12px;border-radius:999px;border:1px solid #d0d0d0;background:#fafafa;font-size:14px;user-select:none}
  .btn[aria-pressed="true"]{border-color:#000;background:#fff}
  .btn.hour{outline:2px solid rgba(37,99,235,.2)}
  .btn.minute{outline:2px solid rgba(220,38,38,.2)}
  select{margin:6px;padding:6px 10px;font-size:16px}
  .row{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;align-items:center}
  .info{margin-top:16px;font-size:16px}
  .legend{font-size:13px;opacity:.8}
  @media (max-width:420px){ canvas{width:260px;height:260px} }
</style>
</head>
<body>

<h2>24-Hour Clock â€” Choose Hour then Minute</h2>

<div class="clock-wrap" style="border:2px solid #16a34a">
  <h3>Start Time</h3>
  <div class="controls">
    <button class="btn hour"   data-target="start" data-hand="hour"   aria-pressed="true">Select Hour</button>
    <button class="btn minute" data-target="start" data-hand="minute" aria-pressed="false">Select Minute</button>
  </div>
  <canvas id="startClock" width="300" height="300" style="border-color:#16a34a"></canvas>
  <div class="row">
    Hour: <select id="startHour"></select>
    Minute: <select id="startMinute"></select>
  </div>
  <div class="legend">Drag anywhere on the selected hand. Minute hand is thicker.</div>
</div>

<div class="clock-wrap" style="border:2px solid #dc2626">
  <h3>End Time</h3>
  <div class="controls">
    <button class="btn hour"   data-target="end" data-hand="hour"   aria-pressed="true">Select Hour</button>
    <button class="btn minute" data-target="end" data-hand="minute" aria-pressed="false">Select Minute</button>
  </div>
  <canvas id="endClock" width="300" height="300" style="border-color:#dc2626"></canvas>
  <div class="row">
    Hour: <select id="endHour"></select>
    Minute: <select id="endMinute"></select>
  </div>
  <div class="legend">Only the selected hand moves.</div>
</div>

<div class="info">
  <div>Start: <span id="startTime">--:--</span></div>
  <div>End: <span id="endTime">--:--</span></div>
  <div>Difference: <span id="diffTime">--:--</span></div>
</div>

<script>
/* ---------- Shared state (minutes from 00:00) ---------- */
let startTotal = 9*60, endTotal = 17*60;

const pad = n => String(n).padStart(2,"0");
const hmFromMin = m => ({h: Math.floor((m%1440+1440)%1440/60), m: ((m%60)+60)%60});
const minFromHM = (h,m) => ((h*60+m)%1440+1440)%1440;

function updateSummary(){
  const s = hmFromMin(startTotal), e = hmFromMin(endTotal);
  document.getElementById("startTime").textContent = `${pad(s.h)}:${pad(s.m)}`;
  document.getElementById("endTime").textContent   = `${pad(e.h)}:${pad(e.m)}`;
  let diff = endTotal - startTotal; if(diff<0) diff += 1440;
  document.getElementById("diffTime").textContent = `${Math.floor(diff/60)}h ${diff%60}m`;
}

function scaleCanvas(canvas){
  const dpr = window.devicePixelRatio || 1;
  const rect = canvas.getBoundingClientRect();
  canvas.width = Math.round(rect.width*dpr);
  canvas.height= Math.round(rect.height*dpr);
  const ctx = canvas.getContext("2d");
  ctx.setTransform(dpr,0,0,dpr,0,0);
  return {ctx, r: Math.min(rect.width, rect.height)/2};
}

/* distance from point P to line segment AB */
function distPointToSeg(px,py, ax,ay, bx,by){
  const ABx=bx-ax, ABy=by-ay, APx=px-ax, APy=py-ay;
  const ab2 = ABx*ABx + ABy*ABy;
  const t = ab2 ? Math.max(0, Math.min(1, (APx*ABx + APy*ABy)/ab2)) : 0;
  const cx = ax + t*ABx, cy = ay + t*ABy;
  const dx = px - cx, dy = py - cy;
  return Math.hypot(dx,dy);
}

function Clock({id, canvasId, hourSelectId, minuteSelectId, isStart}){
  const canvas = document.getElementById(canvasId);
  const hourSel = document.getElementById(hourSelectId);
  const minSel  = document.getElementById(minuteSelectId);
  const btnHour   = document.querySelector(`.btn.hour[data-target="${id}"]`);
  const btnMinute = document.querySelector(`.btn.minute[data-target="${id}"]`);

  // thicker minute hand + bigger hitbox
  const HOUR_W_INACTIVE=5, HOUR_W_ACTIVE=7;
  const MIN_W_INACTIVE =10, MIN_W_ACTIVE =12;
  const MIN_TIP_R      =7;

  // hitbox radii (how easy it is to grab along the line)
  const HOUR_HIT = 14;
  const MIN_HIT  = 22; // easier to grab minutes anywhere on the red hand

  let activeHand = "hour";
  const getTotal = ()=> isStart ? startTotal : endTotal;
  const setTotal = v => { if(isStart) startTotal=v; else endTotal=v; };

  // dropdowns
  for(let i=0;i<24;i++){ const o=document.createElement("option"); o.value=i; o.text=i; hourSel.appendChild(o); }
  for(let i=0;i<60;i++){ const o=document.createElement("option"); o.value=i; o.text=pad(i); minSel.appendChild(o); }
  let {h,m} = hmFromMin(getTotal()); hourSel.value=h; minSel.value=m;

  function setActive(hand){
    activeHand = hand;
    btnHour.setAttribute("aria-pressed", hand==="hour");
    btnMinute.setAttribute("aria-pressed", hand==="minute");
    draw();
  }

  btnHour.addEventListener("click", ()=>setActive("hour"));
  btnMinute.addEventListener("click",()=>setActive("minute"));

  function draw(){
    const {ctx, r} = scaleCanvas(canvas);
    ctx.translate(r,r);
    ctx.clearRect(-r,-r,2*r,2*r);

    // dial
    ctx.beginPath(); ctx.arc(0,0,r-4,0,Math.PI*2); ctx.fillStyle="#fff"; ctx.fill(); ctx.stroke();
    // marks
    ctx.font="12px Arial"; ctx.textAlign="center"; ctx.textBaseline="middle";
    for(let i=0;i<24;i++){
      const a=(i/24)*Math.PI*2 - Math.PI/2;
      const x=Math.cos(a)*(r-20), y=Math.sin(a)*(r-20);
      ctx.beginPath(); ctx.arc(x,y,3,0,Math.PI*2); ctx.fillStyle="#000"; ctx.fill();
      ctx.fillText(i, Math.cos(a)*(r-40), Math.sin(a)*(r-40));
    }

    // hour hand
    const ha = ((h + m/60)/24)*Math.PI*2 - Math.PI/2;
    ctx.save();
    ctx.strokeStyle = activeHand==="hour" ? "var(--hour)" : "rgba(0,0,0,.4)";
    ctx.lineWidth   = activeHand==="hour" ? HOUR_W_ACTIVE : HOUR_W_INACTIVE;
    if(activeHand==="hour"){ ctx.shadowColor="rgba(37,99,235,.45)"; ctx.shadowBlur=12; }
    ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(Math.cos(ha)*(r-50), Math.sin(ha)*(r-50)); ctx.stroke();
    ctx.restore();

    // minute hand (THICKER + tip)
    const ma = (m/60)*Math.PI*2 - Math.PI/2;
    const mLen = r-30, mx = Math.cos(ma)*mLen, my = Math.sin(ma)*mLen;
    ctx.save();
    ctx.strokeStyle = activeHand==="minute" ? "var(--min)" : "rgba(0,0,0,.55)";
    ctx.lineWidth   = activeHand==="minute" ? MIN_W_ACTIVE : MIN_W_INACTIVE;
    if(activeHand==="minute"){ ctx.shadowColor="rgba(220,38,38,.45)"; ctx.shadowBlur=12; }
    ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(mx,my); ctx.stroke();
    ctx.beginPath(); ctx.arc(mx,my,MIN_TIP_R,0,Math.PI*2);
    ctx.fillStyle = activeHand==="minute" ? "var(--min)" : "rgba(0,0,0,.55)";
    ctx.fill();
    ctx.restore();

    // center cap
    ctx.beginPath(); ctx.arc(0,0,4,0,Math.PI*2); ctx.fillStyle="#111"; ctx.fill();
  }

  function commit(){ setTotal(minFromHM(h,m)); updateSummary(); draw(); }

  const angleFrom = (x,y)=> (Math.atan2(y,x)+Math.PI/2+Math.PI*2)%(Math.PI*2);

  let dragging=false;
  function handHitTest(clientX,clientY){
    // check if touch is near the ACTIVE hand anywhere along its length
    const rect = canvas.getBoundingClientRect();
    const px = clientX - rect.left - rect.width/2;
    const py = clientY - rect.top  - rect.height/2;
    const r = Math.min(rect.width, rect.height)/2;

    if(activeHand==="hour"){
      const ha = ((h + m/60)/24)*Math.PI*2 - Math.PI/2;
      const hx = Math.cos(ha)*(r-50), hy = Math.sin(ha)*(r-50);
      return distPointToSeg(px,py, 0,0, hx,hy) <= HOUR_HIT;
    }else{
      const ma = (m/60)*Math.PI*2 - Math.PI/2;
      const mx = Math.cos(ma)*(r-30), my = Math.sin(ma)*(r-30);
      return distPointToSeg(px,py, 0,0, mx,my) <= MIN_HIT;
    }
  }

  function updateFromPoint(clientX, clientY){
    const rect = canvas.getBoundingClientRect();
    const x = clientX - rect.left - rect.width/2;
    const y = clientY - rect.top  - rect.height/2;
    const a = angleFrom(x,y);
    if(activeHand==="hour"){ h = Math.floor((a/(Math.PI*2))*24)%24; hourSel.value=h; }
    else                   { m = Math.floor((a/(Math.PI*2))*60)%60; minSel.value=m; }
    commit();
  }

  function onDown(clientX,clientY){
    // only start dragging if user touched NEAR the selected hand (anywhere along it)
    if(handHitTest(clientX,clientY)){ dragging=true; updateFromPoint(clientX,clientY); }
  }

  function onMouseDown(e){ onDown(e.clientX,e.clientY); window.addEventListener("mousemove", onMouseMove); }
  function onMouseMove(e){ if(dragging) updateFromPoint(e.clientX,e.clientY); }
  function onMouseUp(){ dragging=false; window.removeEventListener("mousemove", onMouseMove); }

  function onTouchStart(e){ e.preventDefault(); const t=e.touches[0]; onDown(t.clientX,t.clientY); }
  function onTouchMove(e){ e.preventDefault(); if(!dragging) return; const t=e.touches[0]; updateFromPoint(t.clientX,t.clientY); }
  function onTouchEnd(){ dragging=false; }

  canvas.addEventListener("mousedown", onMouseDown);
  window.addEventListener("mouseup", onMouseUp);
  canvas.addEventListener("mouseleave", onMouseUp);
  canvas.addEventListener("touchstart", onTouchStart, {passive:false});
  canvas.addEventListener("touchmove",  onTouchMove,  {passive:false});
  canvas.addEventListener("touchend",   onTouchEnd);

  hourSel.addEventListener("change", e=>{ h=(+e.target.value)||0; setActive("hour"); commit(); });
  minSel .addEventListener("change", e=>{ m=(+e.target.value)||0; setActive("minute"); commit(); });

  setActive("hour");
  commit();
}

/* build both clocks */
Clock({id:"start", canvasId:"startClock", hourSelectId:"startHour", minuteSelectId:"startMinute", isStart:true});
Clock({id:"end",   canvasId:"endClock",   hourSelectId:"endHour",   minuteSelectId:"endMinute",   isStart:false});
</script>
</body>
</html>
